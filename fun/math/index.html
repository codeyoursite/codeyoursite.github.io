<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maths Game with Tic Tac Toe</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="../tictactoec/style.css" rel="stylesheet">
</head>
<body>
    <h1 id="hOne">Maths Game</h1>
    <form id="first">
        <label for="first">What's <span id="onel"></span> x 13?</label>
        <input type="text" name="first" id="firstq">
        <input type="submit" value="Check">
    </form>
    <form id="second" style="display: none;">
        <label for="second">What's 14 squared?</label>
        <input type="text" name="second" id="secondq">
        <input type="submit" value="Check">
    </form>
    <form id="third" style="display: none;">
        <label for="third">What's 15 squared?</label>
        <input type="text" name="third" id="thirdq">
        <input type="submit" value="Check">
    </form>
    <form id="fourth" style="display: none;">
        <label for="fourth">What's 12 - -6?</label>
        <input type="text" name="fourth" id="fourthq">
        <input type="submit" value="Check">
    </form>
    <form id="fifth" style="display: none;">
        <label for="fifth">What's 20 x 21?</label>
        <input type="text" name="fifth" id="fifthq">
        <input type="submit" value="Check">
    </form>
    <div class="board" id="board" style="display: none;">
        <img src="https://codeyoursite.github.io/fun/1Pzpe.png">
        <div class="grid">
            <div class="cross cell" id="one">W</div>
            <div class="cross cell" id="two">W</div>
            <div class="cross cell" id="three">W</div>
            <div class="cross cell" id="four">W</div>
            <div class="cross cell" id="five">W</div>
            <div class="cross cell" id="six">W</div>
            <div class="cross cell" id="seven">W</div>
            <div class="cross cell" id="eight">W</div>
            <div class="cross cell" id="nine">W</div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        let index = 0;
        let score = 0;
        let times = 0; // Define times
        let turn = "X"; // Define turn
        let stop = 0; // Define stop
        let win = 0;
        const noms = ["first", "second", "third", "fourth", "fifth"];
        const winningCombos = [
            ["one", "two", "three"],
            ["four", "five", "six"],
            ["seven", "eight", "nine"],
            ["one", "four", "seven"],
            ["two", "five", "eight"],
            ["three", "six", "nine"],
            ["one", "five", "nine"],
            ["three", "five", "seven"]
        ];
        const placeholder = "W"; // Define placeholder
        const cells = document.querySelectorAll(".cell"); // Define cells

        // Add event listener to each form for checking answers
        noms.forEach(formId => {
            document.getElementById(formId).addEventListener("submit", function(e) {
                e.preventDefault();
                const answerId = formId + "q";
                const correctAnswer = getCorrectAnswer(index);
                checkAnswer(answerId, correctAnswer, formId);
            });
        });

        // Function to get the correct answer based on the current index
        function getCorrectAnswer(index) {
            switch (index) {
                case 0:
                    return 12 * 13;
                case 1:
                    return 14 * 14;
                case 2:
                    return 15 * 15;
                case 3:
                    return 12 - (-6);
                case 4:
                    return 20 * 21;
                default:
                    return null;
            }
        }

        // Function to handle checking the answer
        function checkAnswer(inputId, correctAnswer, currentFormId) {
            let val = document.getElementById(inputId).value;
            if (val == correctAnswer) {
                score++;
                Swal.fire({
                    title: "Good job!",
                    text: "You are correct!",
                    icon: "success"
                }).then(() => {
                    document.getElementById(currentFormId).style.display = "none";
                    document.getElementById("board").style.display = "block";
                    // Add event listener to each cell for player's move
                    document.querySelectorAll(".cell").forEach(cell => {
                        cell.addEventListener("click", handleClick);
                    });
                });
            } else {
                score--;
                Swal.fire({
                    title: "You are incorrect.",
                    text: "Please try again",
                    icon: "error"
                });
            }
        }

        // Function to handle cell click
        function handleClick(event) {
            const clickedCell = event.target; // Get the clicked cell
            if (clickedCell.textContent == "W") {
                // Mark cell with player's symbol
                clickedCell.textContent = "X"; // Assuming the player always plays as X
                clickedCell.style.opacity = "100%";
                // Remove event listener to prevent further moves
                document.querySelectorAll(".cell").forEach(cell => {
                    cell.removeEventListener("click", handleClick);
                });
                computer();
                findthewinner();
            } else {
                // Display error message if cell is already marked
                Swal.fire({
                    icon: "error",
                    title: "Choose a different space",
                    text: "The cell you clicked on has already been taken."
                });
            }
        }
        // Function for computer's move
        function computer() {
            if (times >= 9) return;
        
            let madeMove = false;
            const opponent = "X";
        
            // Try to make a winning move
            for (let combo of winningCombos) {
                const [aId, bId, cId] = combo;
                const a = document.getElementById(aId);
                const b = document.getElementById(bId);
                const c = document.getElementById(cId);
        
                if (a.textContent == turn && b.textContent == turn && c.textContent == placeholder) {
                    let rand3 = Math.random();
                    if (rand3 > 0.4) {
                        c.textContent = "O";
                        c.style.opacity = "100%";
                        madeMove = true;
                        break;
                    } else if (rand3 > 0.6) {
                        break;
                    }
                } else if (a.textContent == turn && c.textContent == turn && b.textContent == placeholder) {
                    let rand2 = Math.random();
                    if (rand2 > 0.4) {
                        b.textContent = "O";
                        b.style.opacity = "100%";
                        madeMove = true;
                        break;
                    } else if (rand2 > 0.6) {
                        break;
                    }
                } else if (b.textContent == turn && c.textContent == turn && a.textContent == placeholder) {
                    let rand1 = Math.random();
                    if (rand1 > 0.4) {
                        a.textContent = "O";
                        a.style.opacity = "100%";
                        madeMove = true;
                        break;
                    } else if (rand1 > 0.6) {
                        break;
                    }
                }
            }
        
            // If no winning move was made, try to make a blocking move
            if (!madeMove) {
                for (let combo of winningCombos) {
                    const [aId, bId, cId] = combo;
                    const a = document.getElementById(aId);
                    const b = document.getElementById(bId);
                    const c = document.getElementById(cId);
        
                    if (a.textContent == opponent && b.textContent == opponent && c.textContent == placeholder) {
                        let rand1 = Math.random();
                        if (rand1 > 0.6) {
                            c.textContent = "O";
                            c.style.opacity = "100%";
                            madeMove = true;
                            break;
                        } else if (rand1 > 0.8) {
                            break;
                        }
                    } else if (a.textContent == opponent && c.textContent == opponent && b.textContent == placeholder) {
                        let rand2 = Math.random();
                        if (rand2 > 0.6) {
                            b.textContent = "O";
                            b.style.opacity = "100%";
                            madeMove = true;
                            break;
                        } else if (rand2 > 0.8) {
                            break;
                        }
                    } else if (b.textContent == opponent && c.textContent == opponent && a.textContent == placeholder) {
                        let rand3 = Math.random();
                        if (rand3 > 0.6) {
                            a.textContent = "O";
                            a.style.opacity = "100%";
                            madeMove = true;
                            break;
                        } else if (rand3 > 0.8) {
                            break;
                        }
                    }
                }
            }
        
            // If no winning or blocking move was made, make a random move
            if (!madeMove) {
                let attempts = 0;
                    while (!madeMove && attempts < cells.length) {
                        const randIndex = Math.floor(Math.random() * cells.length);
                        if (cells[randIndex].textContent == placeholder) {
                            cells[randIndex].textContent = "O";
                            cells[randIndex].style.opacity = "100%";
                            madeMove = true;
                        }
                        attempts++;
                    }
            }
        
            // Switch player turn
            turn = "X";
            times++;
            // Check for winner
            findthewinner();
            index++; // Move to the next question
            if (index < noms.length && stop !== 1) {
                setTimeout(function() {
                    // Hide board and show next question
                    document.getElementById("board").style.display = "none";
                    document.getElementById(noms[index]).style.display = "block";
                }, 600);
            } else if (win == 2) {
                document.getElementById("hOne").innerHTML = `Well done! That is the end. <a href="https://codeyoursite.github.io/fun/math/">Play again.</a>`
            } else {
                document.getElementById("hOne").textContent = `Never mind. <a href="https://codeyoursite.github.io/fun/math/">Play again.</a>`
            }
        }

        // Function to check for winner
        function findthewinner() {
            // Iterate through each winning combination
            for (let combo of winningCombos) {
                const [aId, bId, cId] = combo;
                const a = document.getElementById(aId);
                const b = document.getElementById(bId);
                const c = document.getElementById(cId);

                // Check if cells in the current combination have the same non-empty content
                if (a.textContent && a.textContent === b.textContent && a.textContent === c.textContent && a.textContent !== placeholder) {
                    if (a.textContent == "X") {
                        stop = 1;
                        win = 2;
                        // Display success message for the winner
                        Swal.fire({
                            icon: "success",
                            title: `You beat the computer!`,
                            text: "Well done.",
                            confirmButtonText: "Close"
                        }).then((result) => {
                            if (result.isConfirmed) refresh();
                        });
                    } else if (a.textContent == "O") {
                        stop = 1;
                        win = 1;
                        // Display sad message for the loser
                        Swal.fire({
                            icon: "error",
                            title: `Oh no!`,
                            text: "The computer beat you.",
                            confirmButtonText: "Close"
                        })
                    }
                    return;
                }
            }

            // If all cells are marked and there is no winner, it's a draw
            if (times >= 9 && stop == 0) {
                stop = 1;
                win = 3;
                // Display draw message
                Swal.fire({
                    icon: "info",
                    title: "It's a draw!",
                    text: "All squares have been used.",
                    confirmButtonText: "Close"
                });
            }
        }
    </script>
</body>
</html>
